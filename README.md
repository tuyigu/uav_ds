# UDS: 工业级城市无人机配送系统 (UAV Delivery System)

## 🚀 项目愿景
UDS 是一个集成了 **ROS 2 机器人控制**、**行为树决策逻辑**、**Web 集群调度**与 **WebRTC 远程监控**的端到端无人机配送解决方案。本项目旨在解决城市复杂环境下的“末端 100 米”配送难题，通过高可靠的软件架构，将先进的算法（VLN, SLAM, YOLO）转化为可落地的工业级产品。

---

## 🏗️ 系统架构设计 (Architecture)

系统采用 **“慢决策、快执行、高观测”** 的解耦设计，确保在异构系统环境下的极致鲁棒性。

### 1. 云端调度层 (Cloud Fleet Management) - *FastAPI / React*
*   **集中式调度**：从“无人机主动接单”升级为“云端最优匹配”。基于无人机实时位置、电池电量及任务优先级进行全局分配。
*   **数字孪生监控**：实时同步无人机坐标与任务状态，提供可视化看板。
*   **指令兜底**：具备最高优先级的远程干预接口，可一键执行紧急悬停或返航。

### 2. 逻辑决策层 (Logic Hub) - *BehaviorTree.CPP*
*   **行为树编排**：利用行为树（BT）取代传统状态机，优雅处理任务打断、异常回退（Fallback）与并行监控。
*   **任务原子化**：将复杂的配送过程拆解为 `Takeoff`、`Navigate`、`Search_Marker`、`Precision_Landing` 等原子行为。

### 3. 感知与定位层 (Perception & Localization)
*   **多级定位接力**：
    *   **干线阶段**：GPS + 3D Lidar SLAM 融合定位。
    *   **末端阶段**：自动切换至局部坐标系，利用 **ArUco 码** 或 **YOLO** 进行视觉伺服对准，解决 GPS 漂移。
*   **障碍物监控**：独立的避障节点，基于雷达/深度相机数据为行为树提供 `SafetyStatus`。

### 4. 高稳执行层 (Execution Layer) - *Flight Core & PX4*
*   **影子目标控制 (Shadow Target)**：采用轨迹插值算法，避免控制指令突变带来的机体抖动。
*   **Action 化接口**：将所有持续性物理过程（起飞、平移、降落）封装为 ROS 2 Action，解决异步调用中的状态冲突。

### 5. 并列观测层 (Parallel Monitoring) - *WebRTC*
*   **独立视频流**：视频传输程序独立于 ROS 2 运行，直接调用硬件编码器，确保在系统高载荷下仍有 <200ms 的监控延迟。
*   **远程临场 (Telepresence)**：支持 Web 端通过 DataChannel 直接接管底层控制，实现人在回路（Human-in-the-loop）的应急保障。

---

## 🛠️ 技术栈 (Tech Stack)

| 维度 | 技术选型 |
| :--- | :--- |
| **机器人框架** | ROS 2 (Humble / Foxy) |
| **飞控底层** | PX4 Autopilot + MAVROS/PX4-ROS2-Bridge |
| **决策逻辑** | BehaviorTree.CPP v4 / Groot |
| **感知算法** | YOLOv8 (目标识别), Fast-LIO/LeGO-LOAM (SLAM) |
| **后端开发** | Python FastAPI + WebSocket + PostgreSQL |
| **实时流媒体** | WebRTC (aiortc / GStreamer) |
| **仿真环境** | Gazebo / Ignition + PX4 SITL |

---

## 🎯 核心特性与亮点

### 1. 应对“末端 100 米”的鲁棒设计
在进入城市走廊后的末端下降区间，系统自动降低对 GPS 的依赖，通过**局部坐标系动态锚定**技术，将视觉反馈引入控制闭环，确保在“城市峡谷”环境下的精准触达。

### 2. 为“失败”而设计
*   **多层级容错**：行为树内置 `Sequence-Fallback` 逻辑。识别丢失时自动进入惯性推算，严重异常时自动切换至人工 WebRTC 接管模式。
*   **状态透明化**：所有逻辑节点状态实时上报，实现故障的秒级定位。

### 3. 异步架构优化
针对大模型（VLN/LLM）推理慢、飞控响应要求快的矛盾，设计了异步意图下发机制。大模型仅负责更新“中间目标点”，行为树负责维护“飞行状态”，`FlightCore` 负责“高频执行”。

---

## 📅 开发计划 (Roadmap)
- [x] 基于 **Shadow Target** 的改良版 Flight Core 开发。
- [x] 基于 **FastAPI** 的集群调度原型构建。
- [ ] **BehaviorTree** 核心节点（Takeoff/Move/Land）封装。
- [ ] 集成 **ArUco/YOLO** 辅助降落系统。
- [ ] 接入 **WebRTC** 独立视频流传输链路。
- [ ] 接入 **VLN (Vision-Language Navigation)** 模型，实现语义指令解析。

---

## 👨‍💻 岗位适配度
本项目涵盖了机器人开发的完整生命周期，特别适配以下岗位：
*   **机器人系统架构师**：异构系统集成、通信协议设计、故障隔离机制。
*   **决策规划工程师**：基于行为树的复杂任务决策、多级导航模式切换。
*   **无人机系统工程师**：PX4 深度定制、低空经济业务逻辑落地。
*   **机器人平台开发**：Web-to-Robot 调度链路、实时流媒体监控。

---

> *“在工业界，一个能稳定运行1万次不炸机的简单系统，价值远高于一个不可控的演示 Demo。”*
